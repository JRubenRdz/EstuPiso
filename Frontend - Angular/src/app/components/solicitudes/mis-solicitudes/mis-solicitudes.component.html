<div class="container-fluid py-4">
  <div class="container">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="text-primary mb-2">
              <i class="bi bi-heart me-2"></i>Mis Solicitudes
            </h2>
            <p class="text-muted mb-0">Gestiona tus solicitudes de vivienda</p>
          </div>
          <a routerLink="/buscar" class="btn btn-outline-primary">
            <i class="bi bi-search me-2"></i>Buscar Viviendas
          </a>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3 text-muted">Cargando tus solicitudes...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="row justify-content-center">
      <div class="col-md-6">
        <div class="alert alert-danger text-center" role="alert">
          <i class="bi bi-exclamation-triangle display-4 text-danger mb-3"></i>
          <h4>{{ error }}</h4>
          <a routerLink="/login" class="btn btn-outline-danger mt-3" *ngIf="error.includes('iniciar sesión')">
            <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
          </a>
        </div>
      </div>
    </div>

    <!-- Solicitudes List -->
    <div *ngIf="!isLoading && !error">
      <!-- Empty State -->
      <div *ngIf="solicitudes.length === 0" class="text-center py-5">
        <i class="bi bi-heart display-1 text-muted mb-3"></i>
        <h4 class="text-muted">No tienes solicitudes</h4>
        <p class="text-muted mb-4">Comienza a buscar la vivienda perfecta para ti</p>
        <a routerLink="/buscar" class="btn btn-primary">
          <i class="bi bi-search me-2"></i>Buscar Viviendas
        </a>
      </div>

      <!-- Solicitudes Cards -->
      <div *ngIf="solicitudes.length > 0" class="row g-4">
        <div class="col-lg-6" *ngFor="let solicitud of solicitudes">
          <div class="card border-0 shadow-lg solicitud-card h-100">
            <div class="card-body p-4">
              <!-- Estado y fecha -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <span [class]="'badge fs-6 px-3 py-2 ' + getEstadoClass(solicitud.estado)">
                  <i [class]="'me-2 ' + getEstadoIcon(solicitud.estado)"></i>
                  {{ solicitud.estado }}
                </span>
                <small class="text-muted">{{ formatearFecha(solicitud.fechaSolicitud) }}</small>
              </div>

              <!-- Información de la vivienda -->
              <h5 class="card-title text-primary mb-2">
                <a [routerLink]="['/vivienda', solicitud.viviendaId]" class="text-decoration-none">
                  {{ solicitud.viviendaTitulo }}
                </a>
              </h5>
              
              <p class="text-muted mb-3">
                <i class="bi bi-geo-alt me-1"></i>
                {{ solicitud.viviendaCalle }}, {{ solicitud.viviendaNumero }}
              </p>

              <!-- Mensaje del estudiante -->
              <div *ngIf="solicitud.mensaje" class="mb-3">
                <h6 class="text-muted mb-2">Tu mensaje:</h6>
                <div class="bg-light p-3 rounded">
                  <p class="mb-0 text-sm">{{ solicitud.mensaje }}</p>
                </div>
              </div>

              <!-- Respuesta del anunciante -->
              <div *ngIf="solicitud.respuestaAnunciante" class="mb-3">
                <h6 class="text-muted mb-2">Respuesta del anunciante:</h6>
                <div class="bg-primary bg-opacity-10 p-3 rounded border-start border-primary border-4">
                  <p class="mb-0 text-sm">{{ solicitud.respuestaAnunciante }}</p>
                  <small class="text-muted">{{ formatearFecha(solicitud.fechaRespuesta!) }}</small>
                </div>
              </div>

              <!-- Acciones -->
              <div class="d-flex gap-2 mt-auto">
                <a 
                  [routerLink]="['/vivienda', solicitud.viviendaId]" 
                  class="btn btn-outline-primary btn-sm flex-fill">
                  <i class="bi bi-eye me-1"></i>Ver Vivienda
                </a>
                
                <button 
                  *ngIf="solicitud.estado === 'PENDIENTE'"
                  class="btn btn-outline-danger btn-sm"
                  (click)="cancelarSolicitud(solicitud)"
                  title="Cancelar solicitud">
                  <i class="bi bi-x-circle"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
